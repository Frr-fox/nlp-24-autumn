from	from	from
:	:	:
inoue@crd.yokogawa.co.jp	inoue@crd.yokogawa.co.jp	inoue@crd.yokogawa.co.jp
(	(	(
inoue	inou	inoue
takeshi	takeshi	takeshi
)	)	)

subject	subject	subject
:	:	:
how	how	how
to	to	to
see	see	see
characterset	characterset	characterset
from	from	from
wchar_t	wchar_t	wchar_t

nntp	nntp	nntp
-	-	-
posting	post	posting
-	-	-
host	host	host
:	:	:
emu	emu	emu

distribution	distribut	distribution
:	:	:
comp	comp	comp

organization	organ	organization
:	:	:
yokogawa	yokogawa	yokogawa
electric	electr	electric
corporation	corpor	corporation
,	,	,
tokyo	tokyo	tokyo
,	,	,
japan	japan	japan

lines	line	line
:	:	:
137	137	137

we	we	we
developed	develop	developed
a	a	a
toolkit	toolkit	toolkit
running	run	running
on	on	on
the	the	the
x	x	x
window	window	window
system	system	system
.	.	.

the	the	the
toolkit	toolkit	toolkit
copes	cope	cope
with	with	with
any	ani	any
languages	languag	language
based	base	based
on	on	on
x11r5	x11r5	x11r5
'	'	'
s	s	s
i18n	i18n	i18n
facility	facil	facility
.	.	.

as	as	a
you	you	you
know	know	know
,	,	,
there	there	there
are	are	are
2	2	2
kinds	kind	kind
of	of	of
i18n	i18n	i18n
implementation	implement	implementation
from	from	from
mit	mit	mit
'	'	'
s	s	s
x11r5	x11r5	x11r5
release	releas	release
-	-	-
-	-	-
xsi	xsi	xsi
and	and	and
ximp	ximp	ximp
.	.	.

our	our	our
original	origin	original
implementation	implement	implementation
of	of	of
the	the	the
toolkit	toolkit	toolkit
uses	use	us
xsi	xsi	xsi
.	.	.

our	our	our
toolkit	toolkit	toolkit
manages	manag	manages
each	each	each
character	charact	character
'	'	'
s	s	s
size	size	size
based	base	based
on	on	on
our	our	our
own	own	own
font	font	font
management	manag	management
system	system	system
.	.	.

in	in	in
order	order	order
to	to	to
do	do	do
that	that	that
,	,	,
the	the	the
'	'	'
wchar_t	wchar_t	wchar_t
'	'	'
typed	type	typed
character	charact	character
strings	string	string
must	must	must
be	be	be
decomposed	decompos	decomposed
to	to	to
character	charact	character
sets	set	set
.	.	.

this	this	this
means	mean	mean
that	that	that
if	if	if
one	one	one
wchar_t	wchar_t	wchar_t
type	type	type
compound	compound	compound
string	string	string
with	with	with
ascii	ascii	ascii
and	and	and
kanji	kanji	kanji
mixed	mix	mixed
,	,	,
for	for	for
example	exampl	example
,	,	,
is	is	is
given	given	given
,	,	,
each	each	each
element	element	element
of	of	of
the	the	the
wchar_t	wchar_t	wchar_t
array	array	array
must	must	must
be	be	be
checked	check	checked
its	it	it
corresponding	correspond	corresponding
character	charact	character
set	set	set
based	base	based
on	on	on
a	a	a
bit	bit	bit
layout	layout	layout
and	and	and
application	applic	application
environment	environ	environment
'	'	'
s	s	s
locale	local	locale
.	.	.

in	in	in
this	this	this
case	case	case
if	if	if
the	the	the
locale	local	locale
is	is	is
'	'	'
japanese	japanes	japanese
'	'	'
,	,	,
each	each	each
wchar_t	wchar_t	wchar_t
character	charact	character
will	will	will
be	be	be
classified	classifi	classified
either	either	either
to	to	to
iso8859	iso8859	iso8859
-	-	-
1	1	1
,	,	,
jisx0208	jisx0208	jisx0208
or	or	or
so	so	so
.	.	.

we	we	we
need	need	need
a	a	a
function	function	function
to	to	to
do	do	do
this	this	this
.	.	.

the	the	the
function	function	function
must	must	must
check	check	check
how	how	how
many	mani	many
characters	charact	character
from	from	from
the	the	the
top	top	top
are	are	are
the	the	the
same	same	same
character	charact	character
set	set	set
and	and	and
what	what	what
the	the	the
character	charact	character
set	set	set
is	is	is
.	.	.

we	we	we
could	could	could
not	not	not
find	find	find
any	ani	any
public	public	public
x11r5	x11r5	x11r5
function	function	function
to	to	to
do	do	do
that	that	that
and	and	and
inevitably	inevit	inevitably
,	,	,
used	use	used
xsi	xsi	xsi
'	'	'
s	s	s
internal	intern	internal
functions	function	function
to	to	to
construct	construct	construct
that	that	that
function	function	function
.	.	.

the	the	the
following	follow	following
is	is	is
the	the	the
source	sourc	source
code	code	code
of	of	of
that	that	that
function	function	function
'	'	'
decomposecharacterset	decomposecharacterset	decomposecharacterset
(	(	(
)	)	)
'	'	'
.	.	.

/	/	/
/	/	/
i18n	i18n	i18n
.	.	.
h	h	h

/	/	/
/	/	/
this	this	this
may	may	may
look	look	look
like	like	like
c	c	c
code	code	code
,	,	,
but	but	but
it	it	it
is	is	is
really	realli	really
-	-	-
*	*	*
-	-	-
c	c	c
+	+	+
+	+	+
-	-	-
*	*	*
-	-	-

/	/	/
/	/	/
$	$	$
id	id	id
:	:	:
i18n	i18n	i18n
.	.	.
h	h	h
,	,	,
v	v	v
1	1	1
.	.	.
1	1	1
1992	1992	1992
/	/	/
01	01	01
/	/	/
21	21	21
12	12	12
:	:	:
05	05	05
:	:	:
24	24	24
iima	iima	iima
exp	exp	exp
iima	iima	iima
$	$	$

#	#	#
ifndef	ifndef	ifndef
_i18n_h	_i18n_h	_i18n_h

#	#	#
define	defin	define
_i18n_h	_i18n_h	_i18n_h

#	#	#
include	includ	include
<	<	<
x11	x11	x11
/	/	/
xlib	xlib	xlib
.	.	.
h	h	h
>	>	>

extern	extern	extern
int	int	int
decomposecharacterset	decomposecharacterset	decomposecharacterset
(	(	(
const	const	const
wchar_t	wchar_t	wchar_t
*	*	*
wc_str	wc_str	wc_str
,	,	,
/	/	/
*	*	*
in	in	in
*	*	*
/	/	/

int	int	int
wc_len	wc_len	wc_len
,	,	,
/	/	/
*	*	*
in	in	in
*	*	*
/	/	/

char	char	char
*	*	*
buf	buf	buf
,	,	,
/	/	/
*	*	*
out	out	out
*	*	*
/	/	/

int	int	int
*	*	*
buflen	buflen	buflen
,	,	,
/	/	/
*	*	*
in	in	in
/	/	/
out	out	out
*	*	*
/	/	/

int	int	int
*	*	*
scanned_len	scanned_len	scanned_len
,	,	,
/	/	/
*	*	*
out	out	out
*	*	*
/	/	/

char	char	char
*	*	*
*	*	*
charset	charset	charset
)	)	)
;	;	;
/	/	/
*	*	*
out	out	out
*	*	*
/	/	/
extern	extern	extern
xmstring	xmstring	xmstring
wchartoxmstring	wchartoxmstr	wchartoxmstring
(	(	(
const	const	const
wchar_t	wchar_t	wchar_t
*	*	*
wc_str	wc_str	wc_str
)	)	)
;	;	;
extern	extern	extern
xmstringcharset	xmstringcharset	xmstringcharset
charsetofwchar	charsetofwchar	charsetofwchar
(	(	(
const	const	const
wchar_t	wchar_t	wchar_t
wc	wc	wc
)	)	)
;	;	;

#	#	#
endif	endif	endif
/	/	/
*	*	*
_i18n_h	_i18n_h	_i18n_h
*	*	*
/	/	/

/	/	/
/	/	/
i18n	i18n	i18n
.	.	.
cc	cc	cc

/	/	/
*	*	*
$	$	$
id	id	id
:	:	:
i18n	i18n	i18n
.	.	.
cc	cc	cc
,	,	,
v	v	v
1	1	1
.	.	.
1	1	1
1992	1992	1992
/	/	/
01	01	01
/	/	/
21	21	21
12	12	12
:	:	:
05	05	05
:	:	:
05	05	05
iima	iima	iima
exp	exp	exp
$	$	$
*	*	*
/	/	/

#	#	#
include	includ	include
<	<	<
stdlib	stdlib	stdlib
.	.	.
h	h	h
>	>	>

#	#	#
include	includ	include
<	<	<
x11	x11	x11
/	/	/
xlibint	xlibint	xlibint
.	.	.
h	h	h
>	>	>

#	#	#
include	includ	include
<	<	<
xm	xm	xm
/	/	/
xm	xm	xm
.	.	.
h	h	h
>	>	>

#	#	#
include	includ	include
"	"	"
i18n	i18n	i18n
.	.	.
h	h	h
"	"	"

extern	extern	extern
"	"	"
c	c	c
"	"	"
{	{	{

#	#	#
include	includ	include
<	<	<
x11	x11	x11
/	/	/
wchar	wchar	wchar
.	.	.
h	h	h
>	>	>

#	#	#
define	defin	define
_xwcdecomposeglyphcharset	_xwcdecomposeglyphcharset	_xwcdecomposeglyphcharset
xxx_xwcdecomposeglyphcharset	xxx_xwcdecomposeglyphcharset	xxx_xwcdecomposeglyphcharset

#	#	#
define	defin	define
_xmbfscs	_xmbfscs	_xmbfscs
xxx_xmbfscs	xxx_xmbfscs	xxx_xmbfscs

#	#	#
define	defin	define
_xmbctidtocsid	_xmbctidtocsid	_xmbctidtocsid
xxx_xmbctidtocsid	xxx_xmbctidtocsid	xxx_xmbctidtocsid

#	#	#
include	includ	include
"	"	"
xlocaleint	xlocaleint	xlocaleint
.	.	.
h	h	h
"	"	"

#	#	#
undef	undef	undef
_xwcdecomposeglyphcharset	_xwcdecomposeglyphcharset	_xwcdecomposeglyphcharset

#	#	#
undef	undef	undef
_xmbfscs	_xmbfscs	_xmbfscs

#	#	#
undef	undef	undef
_xmbctidtocsid	_xmbctidtocsid	_xmbctidtocsid

extern	extern	extern
int	int	int
_xwcdecomposeglyphcharset	_xwcdecomposeglyphcharset	_xwcdecomposeglyphcharset
(	(	(
xlocale	xlocal	xlocale
,	,	,
const	const	const
wchar_t	wchar_t	wchar_t
*	*	*
,	,	,
int	int	int
,	,	,
char	char	char
*	*	*
,	,	,
int	int	int
*	*	*
,	,	,
int	int	int
*	*	*
,	,	,
int	int	int
*	*	*
)	)	)
;	;	;

extern	extern	extern
charset	charset	charset
*	*	*
_xmbfscs	_xmbfscs	_xmbfscs
(	(	(
xlocale	xlocal	xlocale
,	,	,
_csid	_csid	_csid
)	)	)
;	;	;

extern	extern	extern
_csid	_csid	_csid
_xmbctidtocsid	_xmbctidtocsid	_xmbctidtocsid
(	(	(
xlocale	xlocal	xlocale
,	,	,
_csid	_csid	_csid
)	)	)
;	;	;

}	}	}
;	;	;

int	int	int
decomposecharacterset	decomposecharacterset	decomposecharacterset
(	(	(
const	const	const
wchar_t	wchar_t	wchar_t
*	*	*
wc_str	wc_str	wc_str
,	,	,
/	/	/
*	*	*
in	in	in
*	*	*
/	/	/

int	int	int
wc_len	wc_len	wc_len
,	,	,
/	/	/
*	*	*
in	in	in
*	*	*
/	/	/

char	char	char
*	*	*
buf	buf	buf
,	,	,
/	/	/
*	*	*
out	out	out
*	*	*
/	/	/

int	int	int
*	*	*
buf_len	buf_len	buf_len
,	,	,
/	/	/
*	*	*
in	in	in
/	/	/
out	out	out
*	*	*
/	/	/

int	int	int
*	*	*
scanned_len	scanned_len	scanned_len
,	,	,
/	/	/
*	*	*
out	out	out
*	*	*
/	/	/

char	char	char
*	*	*
*	*	*
charset	charset	charset
)	)	)
/	/	/
*	*	*
out	out	out
*	*	*
/	/	/

{	{	{

xlocale	xlocal	xlocale
xlocale	xlocal	xlocale
=	=	=
_xfallbackconvert	_xfallbackconvert	_xfallbackconvert
(	(	(
)	)	)
;	;	;

int	int	int
ctid	ctid	ctid
;	;	;

int	int	int
status	status	status
;	;	;

charset	charset	charset
*	*	*
xcharset	xcharset	xcharset
;	;	;

status	status	status
=	=	=
_xwcdecomposeglyphcharset	_xwcdecomposeglyphcharset	_xwcdecomposeglyphcharset
(	(	(
xlocale	xlocal	xlocale
,	,	,
wc_str	wc_str	wc_str
,	,	,
wc_len	wc_len	wc_len
,	,	,
buf	buf	buf
,	,	,
buf_len	buf_len	buf_len
,	,	,
scanned_len	scanned_len	scanned_len
,	,	,
&	&	&
ctid	ctid	ctid
)	)	)
;	;	;

if	if	if
(	(	(
status	status	status
=	=	=
=	=	=
success	success	success
)	)	)
{	{	{

xcharset	xcharset	xcharset
=	=	=
_xmbfscs	_xmbfscs	_xmbfscs
(	(	(
xlocale	xlocal	xlocale
,	,	,
_xmbctidtocsid	_xmbctidtocsid	_xmbctidtocsid
(	(	(
xlocale	xlocal	xlocale
,	,	,
ctid	ctid	ctid
)	)	)
)	)	)
;	;	;

*	*	*
charset	charset	charset
=	=	=
(	(	(
xcharset	xcharset	xcharset
)	)	)
?	?	?

xcharset	xcharset	xcharset
-	-	-
>	>	>
cs_name	cs_name	cs_name
:	:	:
null	null	null
;	;	;

}	}	}

else	els	else

*	*	*
charset	charset	charset
=	=	=
null	null	null
;	;	;

return	return	return
status	status	status
;	;	;

}	}	}

-	-	-
-	-	-
-	-	-
-	-	-
-	-	-
-	-	-
-	-	-
-	-	-
-	-	-
-	-	-
-	-	-
-	-	-
-	-	-
-	-	-
-	-	-
-	-	-

an	an	an
included	includ	included
file	file	file
above	abov	above
,	,	,
"	"	"
xlocaleint	xlocaleint	xlocaleint
.	.	.
h	h	h
"	"	"
,	,	,
is	is	is
also	also	also
xsi	xsi	xsi
internal	intern	internal
and	and	and
we	we	we
copied	copi	copied
the	the	the
file	file	file
to	to	to
the	the	the
toolkit	toolkit	toolkit
directory	directori	directory
and	and	and
compiled	compil	compiled
.	.	.

a	a	a
serious	serious	serious
issue	issu	issue
occured	occur	occured
when	when	when
we	we	we
tried	tri	tried
to	to	to
compile	compil	compile
a	a	a
toolkit	toolkit	toolkit
application	applic	application
on	on	on
our	our	our
hp	hp	hp
machine	machin	machine
with	with	with
its	it	it
os	os	o
version	version	version
of	of	of
hp	hp	hp
-	-	-
ux9	ux9	ux9
.	.	.
01	01	01
.	.	.

when	when	when
we	we	we
tried	tri	tried
to	to	to
link	link	link
an	an	an
application	applic	application
based	base	based
on	on	on
our	our	our
toolkit	toolkit	toolkit
,	,	,
link	link	link
errors	error	error
occured	occur	occured
saying	say	saying
that	that	that
the	the	the
following	follow	following
functions	function	function
are	are	are
missing	miss	missing
:	:	:

_xmbctidtocsid	_xmbctidtocsid	_xmbctidtocsid
(	(	(
code	code	code
)	)	)

_xmbfscs	_xmbfscs	_xmbfscs
(	(	(
code	code	code
)	)	)

_xwcdecomposeglyphcharset	_xwcdecomposeglyphcharset	_xwcdecomposeglyphcharset
(	(	(
code	code	code
)	)	)

_xfallbackconvert	_xfallbackconvert	_xfallbackconvert
(	(	(
code	code	code
)	)	)

we	we	we
had	had	had
used	use	used
mit	mit	mit
release	releas	release
version	version	version
of	of	of
x11r5	x11r5	x11r5
and	and	and
its	it	it
xsi	xsi	xsi
implementation	implement	implementation
until	until	until
hp	hp	hp
-	-	-
up9	up9	up9
.	.	.
0	0	0
and	and	and
ran	ran	ran
applications	applic	application
successfully	success	successfully
.	.	.

one	one	one
of	of	of
the	the	the
reasons	reason	reason
to	to	to
use	use	use
xsi	xsi	xsi
was	was	wa
that	that	that
because	becaus	because
hp	hp	hp
did	did	did
not	not	not
release	releas	release
hp	hp	hp
'	'	'
s	s	s
x11r5	x11r5	x11r5
until	until	until
the	the	the
os	os	o
9	9	9
.	.	.
0	0	0
and	and	and
we	we	we
had	had	had
no	no	no
way	way	way
to	to	to
know	know	know
how	how	how
hp	hp	hp
'	'	'
s	s	s
r5	r5	r5
would	would	would
be	be	be
implemented	implement	implemented
.	.	.

we	we	we
had	had	had
hoped	hope	hoped
xsi	xsi	xsi
'	'	'
s	s	s
popularity	popular	popularity
and	and	and
used	use	used
its	it	it
internal	intern	internal
functions	function	function
.	.	.

the	the	the
hp	hp	hp
'	'	'
s	s	s
linker	linker	linker
complains	complain	complains
that	that	that
there	there	there
are	are	are
no	no	no
xsi	xsi	xsi
internal	intern	internal
functions	function	function
implemented	implement	implemented
.	.	.

we	we	we
observe	observ	observe
from	from	from
hp	hp	hp
'	'	'
s	s	s
libx11	libx11	libx11
.	.	.
a	a	a
,	,	,
they	they	they
used	use	used
some	some	some
ximp	ximp	ximp
implementation	implement	implementation
but	but	but
we	we	we
are	are	are
not	not	not
sure	sure	sure
if	if	if
they	they	they
used	use	used
mit	mit	mit
'	'	'
s	s	s
vanilla	vanilla	vanilla
ximp	ximp	ximp
version	version	version
or	or	or
their	their	their
own	own	own
version	version	version
of	of	of
ximp	ximp	ximp
and	and	and
therefore	therefor	therefore
,	,	,
finding	find	finding
just	just	just
counter	counter	counter
part	part	part
functions	function	function
in	in	in
mit	mit	mit
'	'	'
s	s	s
ximp	ximp	ximp
for	for	for
xsi	xsi	xsi
does	doe	doe
not	not	not
seem	seem	seem
to	to	to
lead	lead	lead
us	us	u
a	a	a
solution	solut	solution
.	.	.

my	my	my
question	question	question
and	and	and
goal	goal	goal
is	is	is
to	to	to
know	know	know
how	how	how
we	we	we
can	can	can
construct	construct	construct
a	a	a
function	function	function
like	like	like

'	'	'
decomposecharacterset	decomposecharacterset	decomposecharacterset
(	(	(
)	)	)
'	'	'
listed	list	listed
above	abov	above
.	.	.

is	is	is
there	there	there
any	ani	any
function	function	function
to	to	to
check	check	check
character	charact	character
set	set	set
of	of	of
each	each	each
element	element	element
of	of	of
wchar_t	wchar_t	wchar_t
type	type	type
strings	string	string
depending	depend	depending
on	on	on
locales	local	locale
?	?	?

if	if	if
it	it	it
is	is	is
a	a	a
public	public	public
function	function	function
,	,	,
that	that	that
is	is	is
perfect	perfect	perfect
but	but	but
even	even	even
if	if	if
it	it	it
is	is	is
not	not	not
,	,	,
we	we	we
want	want	want
to	to	to
use	use	use
any	ani	any
internal	intern	internal
functions	function	function
in	in	in
hp	hp	hp
'	'	'
s	s	s
x11r5	x11r5	x11r5
as	as	a
we	we	we
did	did	did
for	for	for
mit	mit	mit
'	'	'
s	s	s
r5	r5	r5
.	.	.

in	in	in
order	order	order
to	to	to
render	render	render
a	a	a
'	'	'
wchar_t	wchar_t	wchar_t
'	'	'
type	type	type
string	string	string
,	,	,
there	there	there
must	must	must
be	be	be
some	some	some
machinery	machineri	machinery
to	to	to
judge	judg	judge
character	charact	character
sets	set	set
and	and	and
that	that	that
is	is	is
how	how	how
the	the	the
proper	proper	proper
fonts	font	font
are	are	are
selected	select	selected
for	for	for
the	the	the
string	string	string
.	.	.

we	we	we
have	have	have
no	no	no
way	way	way
to	to	to
find	find	find
out	out	out
that	that	that
without	without	without
any	ani	any
hp	hp	hp
'	'	'
s	s	s
x11r5	x11r5	x11r5
source	sourc	source
files	file	file
.	.	.

we	we	we
want	want	want
to	to	to
know	know	know
how	how	how
we	we	we
can	can	can
use	use	use
that	that	that
for	for	for
our	our	our
goal	goal	goal
.	.	.

any	ani	any
help	help	help
or	or	or
comments	comment	comment
would	would	would
be	be	be
highly	high	highly
appreciated	appreci	appreciated
.	.	.

i	i	i
also	also	also
appreciate	appreci	appreciate
if	if	if
anyone	anyon	anyone
tell	tell	tell
me	me	me
about	about	about
ximp	ximp	ximp
treating	treat	treating
around	around	around
this	this	this
area	area	area
even	even	even
if	if	if
it	it	it
is	is	is
not	not	not
hp	hp	hp
'	'	'
s	s	s
implementation	implement	implementation
.	.	.

thank	thank	thank
you	you	you
.	.	.

-	-	-
-	-	-

takeshi	takeshi	takeshi
inoue	inou	inoue

inoue@crd.yokogawa.co.jp	inoue@crd.yokogawa.co.jp	inoue@crd.yokogawa.co.jp

yokogawa	yokogawa	yokogawa
electric	electr	electric
corporation	corpor	corporation

open	open	open
systems	system	system
laboratory	laboratori	laboratory
0422(52)5557	0422(52)5557	0422(52)5557