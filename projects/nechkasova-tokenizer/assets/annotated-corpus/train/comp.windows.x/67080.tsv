from	from	from
:	:	:
prunet@zephir.inria.fr	prunet@zephir.inria.fr	prunet@zephir.inria.fr
(	(	(
vincent	vincent	vincent
prunet	prunet	prunet
)	)	)

subject	subject	subject
:	:	:
re	re	re
:	:	:
monthly	month	monthly
question	question	question
about	about	about
xcopyarea	xcopyarea	xcopyarea
(	(	(
)	)	)
and	and	and
expose	expos	expose
events	event	event

organization	organ	organization
:	:	:
inria	inria	inria
,	,	,
sophia	sophia	sophia
-	-	-
antipolis	antipoli	antipolis
(	(	(
fr	fr	fr
)	)	)

lines	line	line
:	:	:
55	55	55

in	in	in
article	articl	article
<	<	<
buzz.93apr19125438@lion.bear.com	buzz.93apr19125438@lion.bear.com	buzz.93apr19125438@lion.bear.com
>	>	>
,	,	,
buzz@bear.com	buzz@bear.com	buzz@bear.com
(	(	(
buzz	buzz	buzz
moschetti	moschetti	moschetti
)	)	)
writes	write	writes
:	:	:

|	|	|
>	>	>
(	(	(
2nd	2nd	2nd
posting	post	posting
of	of	of
the	the	the
question	question	question
that	that	that
just	just	just
doesn	doesn	doesn
'	'	'
t	t	t
seem	seem	seem
to	to	to
get	get	get
answered	answer	answered
)	)	)

|	|	|
>	>	>

|	|	|
>	>	>
suppose	suppos	suppose
you	you	you
have	have	have
an	an	an
idle	idl	idle
app	app	app
with	with	with
a	a	a
realized	realiz	realized
and	and	and
mapped	map	mapped
window	window	window
that	that	that

|	|	|
>	>	>
contains	contain	contains

|	|	|
>	>	>
xlib	xlib	xlib
graphics	graphic	graphic
.	.	.

a	a	a
button	button	button
widget	widget	widget
,	,	,
when	when	when
pressed	press	pressed
,	,	,
will	will	will
cause	caus	cause
a	a	a
new	new	new
item	item	item

|	|	|
>	>	>
to	to	to
be	be	be
drawn	drawn	drawn
in	in	in
the	the	the
window	window	window
.	.	.

this	this	this
action	action	action
clearly	clear	clearly
should	should	should
not	not	not
call	call	call
xcopyarea	xcopyarea	xcopyarea
(	(	(
)	)	)

|	|	|
>	>	>
|	|	|
>	>	>
(	(	(
or	or	or
equiv	equiv	equiv
)	)	)
directly	direct	directly
;	;	;
instead	instead	instead
,	,	,
it	it	it
should	should	should
register	regist	register
the	the	the
existence	exist	existence
of	of	of
the	the	the

|	|	|
>	>	>
new	new	new

|	|	|
>	>	>
item	item	item
in	in	in
a	a	a
memory	memori	memory
structure	structur	structure
and	and	and
let	let	let
the	the	the
same	same	same
expose	expos	expose
event	event	event
handler	handler	handler
that	that	that

|	|	|
>	>	>
handles	handl	handle

|	|	|
>	>	>
"	"	"
regular	regular	regular
"	"	"
expose	expos	expose
events	event	event
(	(	(
e	e	e
.	.	.
g	g	g
.	.	.
window	window	window
manager	manag	manager
-	-	-
driven	driven	driven
exposures	exposur	exposure
)	)	)
take	take	take
care	care	care

|	|	|
>	>	>
of	of	of
rendering	render	rendering
the	the	the
new	new	new
image	imag	image
.	.	.

using	use	using
an	an	an
expose	expos	expose
event	event	event
handler	handler	handler
is	is	is
a	a	a
"	"	"
proper	proper	proper
"	"	"

|	|	|
>	>	>
way	way	way

|	|	|
>	>	>
to	to	to
do	do	do
this	this	this
because	becaus	because
at	at	at
the	the	the
time	time	time
the	the	the
handler	handler	handler
is	is	is
called	call	called
,	,	,
the	the	the
xlib	xlib	xlib
window	window	window
is	is	is

|	|	|
>	>	>
guaranteed	guarante	guaranteed
to	to	to
be	be	be
mapped	map	mapped
.	.	.

|	|	|
>	>	>

|	|	|
>	>	>
the	the	the
problem	problem	problem
,	,	,
of	of	of
course	cours	course
,	,	,
is	is	is
that	that	that
no	no	no
expose	expos	expose
event	event	event
is	is	is
generated	generat	generated
if	if	if
the	the	the
window	window	window

|	|	|
>	>	>
is	is	is
already	alreadi	already
visible	visibl	visible
and	and	and
mapped	map	mapped
.	.	.

what	what	what
we	we	we
need	need	need
to	to	to
do	do	do
is	is	is
somehow	somehow	somehow
"	"	"
tickle	tickl	tickle
"	"	"
the	the	the

|	|	|
>	>	>
window	window	window
so	so	so
that	that	that
the	the	the
expose	expos	expose
handler	handler	handler
is	is	is
hit	hit	hit
with	with	with
arguments	argument	argument
that	that	that
will	will	will
enable	enabl	enable

|	|	|
>	>	>
it	it	it
to	to	to
render	render	render
*	*	*
just	just	just
*	*	*
the	the	the
part	part	part
of	of	of
the	the	the
window	window	window
that	that	that
contains	contain	contains
the	the	the
new	new	new
item	item	item
.	.	.

|	|	|
>	>	>

|	|	|
>	>	>
what	what	what
is	is	is
the	the	the
best	best	best
way	way	way
to	to	to
tickle	tickl	tickle
a	a	a
window	window	window
to	to	to
produce	produc	produce
this	this	this
behavior	behavior	behavior
?	?	?

to	to	to
incrementally	increment	incrementally
update	updat	update
the	the	the
contents	content	content
of	of	of
windows	window	window
,	,	,
i	i	i
use	use	use
the	the	the
following	follow	following
trick	trick	trick
:	:	:

1	1	1
.	.	.

set	set	set
the	the	the
window	window	window
background	background	background
to	to	to
none	none	none
,	,	,
2	2	2
.	.	.

call	call	call
xcleararea	xcleararea	xcleararea
(	(	(
display	display	display
,	,	,
window	window	window
,	,	,
0	0	0
,	,	,
0	0	0
,	,	,
0	0	0
,	,	,
0	0	0
,	,	,
true	true	true
)	)	)
,	,	,
3	3	3
.	.	.

restore	restor	restore
the	the	the
window	window	window
background	background	background
to	to	to
its	it	it
correct	correct	correct
value	valu	value
.	.	.

the	the	the
call	call	call
to	to	to
xcleararea	xcleararea	xcleararea
does	doe	doe
not	not	not
repaint	repaint	repaint
the	the	the
window	window	window
background	background	background
,	,	,
but	but	but
still	still	still
generates	generat	generates
exposure	exposur	exposure
events	event	event
for	for	for
visible	visibl	visible
parts	part	part
of	of	of
the	the	the
window	window	window
.	.	.

in	in	in
order	order	order
to	to	to
let	let	let
my	my	my
application	applic	application
know	know	know
that	that	that
these	these	these
expose	expos	expose
events	event	event
must	must	must
be	be	be
handled	handl	handled
incrementally	increment	incrementally
(	(	(
something	someth	something
is	is	is
already	alreadi	already
displayed	display	displayed
on	on	on
the	the	the
screen	screen	screen
and	and	and
may	may	may
need	need	need
to	to	to
be	be	be
erased	eras	erased
)	)	)
,	,	,
i	i	i
encapsulate	encapsul	encapsulate
the	the	the
3	3	3
operations	oper	operation
with	with	with
2	2	2
self	self	self
addressed	address	addressed
client	client	client
messages	messag	message
,	,	,
which	which	which
preserve	preserv	preserve
asynchronicity	asynchron	asynchronicity
between	between	between
the	the	the
client	client	client
and	and	and
the	the	the
server	server	server
.	.	.

xgrabserver	xgrabserv	xgrabserver
(	(	(
display	display	display
)	)	)
client	client	client
message	messag	message
(	(	(
start	start	start
-	-	-
incremental	increment	incremental
)	)	)

background	background	background
none	none	none

xcleararea	xcleararea	xcleararea

restore	restor	restore
background	background	background
client	client	client
message	messag	message
(	(	(
end	end	end
-	-	-
incremental	increment	incremental
)	)	)
xungrabserver	xungrabserv	xungrabserver
(	(	(
display	display	display
)	)	)

the	the	the
grabserver	grabserv	grabserver
prevents	prevent	prevents
other	other	other
events	event	event
to	to	to
be	be	be
inserted	insert	inserted
by	by	by
the	the	the
server	server	server
in	in	in
the	the	the
critical	critic	critical
section	section	section
.	.	.

-	-	-
-	-	-
-	-	-
vincent	vincent	vincent
prunet	prunet	prunet
,	,	,
sema	sema	sema
group	group	group
sophia	sophia	sophia
antipolis	antipoli	antipolis
inria	inria	inria
bp	bp	bp
93    06902	93    06902	93    06902
sophia	sophia	sophia
antipolis	antipoli	antipolis
cedex	cedex	cedex
france	franc	france
prunet@sophia.inria.fr	prunet@sophia.inria.fr	prunet@sophia.inria.fr
,	,	,
(	(	(
33) 93 65 78 42	33) 93 65 78 42	33) 93 65 78 42
,	,	,
fax	fax	fax
:	:	:
(	(	(
33) 93 65 77 66	33) 93 65 77 66	33) 93 65 77 66